#include <stdio.h>
#include <string.h>
#include <errno.h>

#include <wiringPi.h>
#include <wiringSerial.h>

int main ()
{
  int fd ;
  int count ;
  unsigned int nextTime ;
  char normal[50]={0x7B, 0x30, 0x34, 0x30, 0x30, 0x32, 0x31, 0x37, 0x30, 0x30, 
                   0x35, 0x30, 0x31, 0x32, 0x34, 0x30, 0x35, 0x30, 0x3F, 0x3F, 
                   0x3F, 0x3F, 0x3F, 0x2E, 0xFF, 0x31, 0x31, 0x30, 0x2E, 0x30, 
                   0x6E, 0x30, 0x2E, 0x30, 0x33, 0x30, 0x30, 0x31, 0x30, 0x2E, 
                   0x32, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x7D, '\0'};

  char normal1[50]={0x7B, 0x30, 0x34, 0x31, 0x30, 0x32, 0x30, 0x31, 0x30, 0x31, 
                   0x30, 0x30, 0x31, 0x30, 0x33, 0x30, 0x35, 0x30, 0x3F, 0x3F, 
                   0x3F, 0x3F, 0x3F, 0x2E, 0xFF, 0x31, 0x30, 0x2E, 0x30, 0x30, 
                   0x75, 0x30, 0x2E, 0x30, 0x33, 0x30, 0x30, 0x31, 0x30, 0x2E, 
                   0x32, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x7D, '\0'};

  char cx_high[50]={0x7B, 0x30, 0x34, 0x30, 0x30, 0x32, 0x31, 0x37, 0x30, 0x30, 
                    0x35, 0x30, 0x31, 0x32, 0x34, 0x30, 0x35, 0x30, 0x3F, 0x3F, 
                    0x3F, 0x3F, 0x3F, 0x2E, 0xFF, 0x20, 0x48, 0x49, 0x47, 0x48, 
                    0x20, 0x30, 0x2E, 0x30, 0x33, 0x30, 0x30, 0x31, 0x30, 0x2E, 
                    0x32, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x7D, '\0'};
  
  char cx_low[50]={0x7B, 0x30, 0x34, 0x30, 0x30, 0x32, 0x31, 0x37, 0x30, 0x30, 
                   0x35, 0x30, 0x31, 0x32, 0x34, 0x30, 0x35, 0x30, 0x3F, 0x3F, 
                   0x3F, 0x3F, 0x3F, 0x2E, 0xFF, 0x20, 0x20, 0x4c, 0x4f, 0x57, 
                   0x20, 0x30, 0x2E, 0x30, 0x33, 0x30, 0x30, 0x31, 0x30, 0x2E, 
                   0x32, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x7D, '\0'};

  char dx_high[50]={0x7B, 0x30, 0x34, 0x30, 0x30, 0x32, 0x31, 0x37, 0x30, 0x30, 
                    0x35, 0x30, 0x31, 0x32, 0x34, 0x30, 0x35, 0x30, 0x3F, 0x3F, 
                    0x3F, 0x3F, 0x3F, 0x2E, 0xFF, 0x31, 0x31, 0x30, 0x2E, 0x30, 
                    0x75, 0x48, 0x49, 0x30, 0x33, 0x30, 0x30, 0x31, 0x30, 0x2E, 
                    0x32, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x7D, '\0'};

  char dx_low[50]={0x7B, 0x30, 0x34, 0x30, 0x30, 0x32, 0x31, 0x37, 0x30, 0x30, 
                   0x35, 0x30, 0x31, 0x32, 0x34, 0x30, 0x35, 0x30, 0x3F, 0x3F, 
                   0x3F, 0x3F, 0x3F, 0x2E, 0xFF, 0x31, 0x31, 0x30, 0x2E, 0x30, 
                   0x75, 0x4c, 0x4f, 0x30, 0x33, 0x30, 0x30, 0x31, 0x30, 0x2E, 
                   0x32, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x7D, '\0'};

  char lc_over[50]={0x7B, 0x30, 0x34, 0x30, 0x30, 0x32, 0x31, 0x37, 0x30, 0x30, 
                     0x35, 0x30, 0x31, 0x32, 0x34, 0x30, 0x35, 0x30, 0x3F, 0x3F, 
                     0x3F, 0x3F, 0x3F, 0x2E, 0xFF, 0x31, 0x31, 0x30, 0x2E, 0x30, 
                     0x75, 0x30, 0x2E, 0x30, 0x33, 0x30, 0x20, 0x4f, 0x56, 0x45, 
                     0x42, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x7D, '\0'};

  char all[50]={0x7B, 0x30, 0x34, 0x30, 0x30, 0x32, 0x31, 0x37, 0x30, 0x30, 
                0x35, 0x30, 0x31, 0x32, 0x34, 0x30, 0x35, 0x30, 0x3F, 0x3F, 
                0x3F, 0x3F, 0x3F, 0x2E, 0xFF, 0x20, 0x48, 0x49, 0x47, 0x48, 
                0x20, 0x48, 0x49, 0x30, 0x33, 0x30, 0x20, 0x4f, 0x56, 0x45, 
                0x42, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x2D, 0x7D, '\0'};

  if ((fd = serialOpen ("/dev/ttyAMA0", 19200)) < 0)
  {
    fprintf (stderr, "Unable to open serial device: %s\n", strerror (errno)) ;
    return 1 ;
  }

  if (wiringPiSetup () == -1)
  {
    fprintf (stdout, "Unable to start wiringPi: %s\n", strerror (errno)) ;
    return 1 ;
  }

  nextTime = millis () + 1000 ;
  int x = 7;
  int y = 1;
  while(1)
  {
      if (millis () > nextTime)
      {
          /*int coun;
          for(coun = 0; coun < 49; coun++)
          {
              printf("%x ", all[coun]);
          }printf("\n");*/
          //serialPuts(fd, all);
          //fflush (stdout) ;
          //printf("y = %d\n", y);
          if (x == 0) 
          {
              serialPuts(fd, normal);
              //x = 7;
          }else if (x == 1) serialPuts(fd, cx_high);
          else if (x == 2) serialPuts(fd, dx_high);
          else if (x == 3) serialPuts(fd, dx_low);
          else if (x == 4) serialPuts(fd, lc_over);
          else if (x == 5) serialPuts(fd, all);
          else if (x == 6) serialPuts(fd, cx_low);
          else  {serialPuts(fd, normal1);}// x = 0;}
   
          nextTime += 1000 ;
          //sleep(1);
          y++;
          //x = (x + 1) % 7;
    }

  }

  return 0 ;
}
